<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mieten vs. Kaufen – Der mathematische Vergleich</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700;800&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --black: #0a0a0a;
      --white: #f7f7f3;
      --card: #ffffff;
      --gray-100: #f0f0ec;
      --gray-200: #e2e2de;
      --gray-400: #999;
      --gray-600: #666;
      --green: #1a7f4b;
      --green-bg: #d4f5e2;
      --red: #c23a3a;
      --red-bg: #fce4e4;
      --accent: #e8e4d9;
      --radius: 12px;
      --font-mono: 'Space Mono', monospace;
      --font-sans: 'Inter', system-ui, sans-serif;
      --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
      --header-h: 54px;
      --content-w: 1080px;
    }

    body {
      font-family: var(--font-sans);
      background: var(--white);
      color: var(--black);
      line-height: 1.5;
    }

    /* ── HEADER ── */
    header {
      position: sticky;
      top: 0;
      height: var(--header-h);
      background: var(--black);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      z-index: 100;
    }
    .header-logo {
      font-family: var(--font-mono);
      font-size: 0.82rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-logo svg { opacity: 0.85; }
    .header-nav {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .header-nav a {
      color: rgba(255,255,255,0.5);
      text-decoration: none;
      font-size: 0.76rem;
      font-weight: 500;
      padding: 6px 14px;
      border-radius: 6px;
      transition: all 0.15s;
    }
    .header-nav a:hover { color: #fff; background: rgba(255,255,255,0.08); }
    .header-nav a.active { color: #fff; background: rgba(255,255,255,0.12); }
    .header-right {
      font-size: 0.76rem;
      color: rgba(255,255,255,0.4);
      font-family: var(--font-mono);
    }

    .header-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 4px;
    }
    .header-menu-toggle svg {
      width: 20px;
      height: 20px;
    }

    /* Country toggle */
    .country-toggle {
      display: flex;
      align-items: center;
      gap: 2px;
      background: rgba(255,255,255,0.08);
      border-radius: 6px;
      padding: 2px;
    }
    .country-btn {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      background: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: var(--font-mono);
      font-size: 0.68rem;
      font-weight: 600;
      color: rgba(255,255,255,0.4);
      transition: all 0.15s;
    }
    .country-btn:hover { color: rgba(255,255,255,0.7); }
    .country-btn.active {
      background: rgba(255,255,255,0.12);
      color: #fff;
    }
    .country-btn svg {
      width: 14px;
      height: 10px;
      border-radius: 1px;
      overflow: hidden;
    }

    /* ── CENTERED CONTAINER ── */
    .container {
      max-width: var(--content-w);
      margin: 0 auto;
      padding: 0 32px;
    }

    /* ── CALCULATOR SECTION ── */
    .calc-section {
      padding: 32px 0 40px;
    }
    .calc-grid {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
      align-items: start;
    }

    /* ── LEFT: INPUTS PANEL ── */
    .inputs-panel {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .mode-toggle {
      display: flex;
      padding: 16px 20px 8px;
    }
    .mode-btn {
      flex: 1;
      padding: 7px 0;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 0.66rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border: 1.5px solid var(--black);
      background: transparent;
      color: var(--black);
      cursor: pointer;
      transition: all 0.15s;
    }
    .mode-btn:first-child { border-radius: 6px 0 0 6px; }
    .mode-btn:last-child { border-radius: 0 6px 6px 0; border-left: none; }
    .mode-btn.active { background: var(--black); color: #fff; }

    .panel-section {
      padding: 16px 20px;
      border-top: 1px solid var(--gray-200);
    }
    .panel-section:first-of-type { border-top: none; }
    .panel-section-title {
      font-family: var(--font-mono);
      font-size: 0.56rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--gray-400);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel-section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--gray-200);
    }
    .field { margin-bottom: 10px; }
    .field:last-child { margin-bottom: 0; }
    .field label {
      display: block;
      font-size: 0.74rem;
      font-weight: 500;
      color: var(--gray-600);
      margin-bottom: 3px;
    }
    .field input {
      width: 100%;
      padding: 8px 10px;
      border: 1.5px solid var(--gray-200);
      border-radius: 8px;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      font-weight: 700;
      background: var(--white);
      color: var(--black);
      outline: none;
      transition: border-color 0.15s;
    }
    .field input:focus { border-color: var(--black); }
    .field .hint {
      font-size: 0.65rem;
      color: var(--gray-400);
      margin-top: 2px;
      font-family: var(--font-mono);
    }
    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .expert-fields { display: none; }
    .expert-fields.visible { display: block; }
    .info-box {
      padding: 10px 12px;
      background: var(--gray-100);
      border-radius: 8px;
      font-size: 0.7rem;
      color: var(--gray-600);
      line-height: 1.55;
    }

    /* ── RIGHT: RESULT + CHART ── */
    .right-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Result banner */
    .result-banner {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px 24px;
      display: flex;
      gap: 20px;
      align-items: flex-start;
      position: relative;
      overflow: hidden;
    }
    .result-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--gray-200);
      transition: background 0.2s;
    }
    .result-banner.has-result::before { background: var(--black); }
    .result-banner-main { flex: 1; }
    .result-badge {
      display: inline-block;
      font-family: var(--font-mono);
      font-size: 0.56rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--gray-400);
      border: 1px solid var(--gray-200);
      border-radius: 4px;
      padding: 2px 8px;
      margin-bottom: 8px;
    }
    .result-headline {
      font-family: var(--font-mono);
      font-size: 1.35rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 5px;
    }
    /* Japanese brush stroke highlight for result keyword */
    .result-headline {
      position: relative;
      z-index: 1;
    }
    .result-keyword {
      position: relative;
      white-space: nowrap;
    }
    .result-keyword::before {
      content: '';
      position: absolute;
      left: -4px;
      right: -4px;
      bottom: 0;
      height: 0.25em;
      background: #ffdb3b;
      z-index: -1;
      transform: skewX(-2deg);
    }

    /* Colored values */
    .val-positive { color: var(--green); }
    .val-negative { color: var(--red); }
    .result-sub { font-size: 0.82rem; color: var(--gray-600); line-height: 1.5; }
    .result-sub b { color: var(--black); }
    .result-disclaimer {
      font-size: 0.66rem;
      color: var(--gray-400);
      margin-top: 6px;
      line-height: 1.5;
    }

    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      margin-left: 4px;
      border-radius: 50%;
      border: 1px solid var(--gray-300, #ccc);
      font-family: var(--font-mono);
      font-size: 0.64rem;
      line-height: 1;
      color: var(--gray-600);
      cursor: pointer;
      position: relative;
      background: rgba(255,255,255,0.9);
    }

    .info-popup {
      position: fixed;
      z-index: 20;
      max-width: 280px;
      padding: 8px 10px;
      border-radius: 8px;
      background: #111;
      color: #f7f7f3;
      font-family: var(--font-sans);
      font-size: 0.72rem;
      line-height: 1.5;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      transform-origin: top left;
    }

    .kpi-strip {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex-shrink: 0;
      min-width: 150px;
    }
    .kpi-box {
      padding: 12px 14px;
      background: var(--gray-100);
      border-radius: 10px;
      text-align: right;
    }
    .kpi-box.kpi-sweetspot {
      background: linear-gradient(135deg, var(--gray-100) 0%, rgba(26, 127, 75, 0.08) 100%);
      border-left: 2px solid var(--green);
    }
    .kpi-label {
      font-family: var(--font-mono);
      font-size: 0.52rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--gray-400);
      margin-bottom: 2px;
    }
    .kpi-value {
      font-family: var(--font-mono);
      font-size: 1.15rem;
      font-weight: 700;
      line-height: 1.2;
    }
    .kpi-unit {
      font-size: 0.65rem;
      color: var(--gray-400);
      font-weight: 400;
    }

    /* Chart card */
    .chart-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 20px;
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .chart-title {
      font-family: var(--font-mono);
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--gray-400);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .chart-legend {
      display: flex;
      gap: 12px;
      font-size: 0.62rem;
      font-family: var(--font-mono);
      color: var(--gray-600);
    }
    .chart-legend span {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .chart-legend .dot-filled {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--green);
    }
    .chart-legend .dot-black {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--black);
    }
    .chart-legend .line-sample {
      width: 16px; height: 2px;
      background: var(--black);
    }
    .chart-wrap {
      position: relative;
      height: 260px;
    }

    /* Details accordion */
    .details-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .details-toggle {
      width: 100%;
      padding: 13px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: none;
      border: none;
      cursor: pointer;
      font-family: var(--font-mono);
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--gray-400);
    }
    .details-toggle .chevron { transition: transform 0.2s; font-size: 0.85rem; }
    .details-toggle.open .chevron { transform: rotate(180deg); }
    .details-body {
      display: none;
      border-top: 1px solid var(--gray-200);
    }
    .details-body.open { display: block; }

    .comp-table { width: 100%; border-collapse: collapse; }
    .comp-table th {
      text-align: left;
      padding: 8px 20px;
      font-family: var(--font-mono);
      font-size: 0.54rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--gray-400);
      font-weight: 400;
      border-bottom: 1px solid var(--gray-200);
    }
    .comp-table td {
      padding: 8px 20px;
      font-size: 0.8rem;
      border-bottom: 1px solid var(--gray-100);
    }
    .comp-table td:first-child { color: var(--gray-600); }
    .comp-table td:not(:first-child) {
      font-family: var(--font-mono);
      font-weight: 600;
      text-align: right;
    }

    /* ── LANDING SECTIONS ── */
    .landing {
      border-top: 1.5px solid var(--black);
    }
    .landing-hero {
      padding: 72px 0 0;
    }
    .landing-hero h2 {
      font-family: var(--font-mono);
      font-size: clamp(1.5rem, 3vw, 2.2rem);
      font-weight: 700;
      line-height: 1.15;
      max-width: 600px;
      margin-bottom: 18px;
    }
    .landing-hero h2 .highlight {
      position: relative;
      white-space: nowrap;
    }
    .landing-hero h2 .highlight::before {
      content: '';
      position: absolute;
      left: -6px;
      right: -6px;
      bottom: 0;
      height: 0.25em;
      background: #ffdb3b;
      z-index: -1;
      transform: skewX(-2deg);
    }
    .landing-hero p {
      font-size: 0.95rem;
      color: var(--gray-600);
      line-height: 1.7;
      max-width: 580px;
    }

    .topic-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 40px;
      padding-bottom: 64px;
    }
    .topic-card {
      padding: 24px;
      border: 1.5px solid var(--gray-200);
      border-radius: var(--radius);
      background: var(--card);
      position: relative;
    }
    .topic-card::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 20px;
      width: 3px;
      height: 24px;
      background: var(--black);
      opacity: 0.15;
    }
    .topic-card:nth-child(2)::before { background: var(--green); opacity: 0.5; }
    .topic-card:nth-child(4)::before { background: var(--red); opacity: 0.4; }
    .topic-card h3 {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 8px;
      line-height: 1.3;
      padding-left: 12px;
    }
    .topic-card p {
      font-size: 0.85rem;
      color: var(--gray-600);
      line-height: 1.6;
    }

    /* FAQ */
    .faq-section {
      padding: 64px 0;
      border-top: 1px solid var(--gray-200);
    }
    .faq-title {
      font-family: var(--font-mono);
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--gray-400);
      margin-bottom: 28px;
    }
    .faq-item { border-bottom: 1px solid var(--gray-200); }
    .faq-q {
      width: 100%;
      background: none;
      border: none;
      padding: 16px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-family: var(--font-sans);
      font-size: 0.92rem;
      font-weight: 600;
      color: var(--black);
      text-align: left;
    }
    .faq-q .plus {
      font-family: var(--font-mono);
      font-size: 1.1rem;
      transition: transform 0.2s;
      flex-shrink: 0;
      margin-left: 16px;
    }
    .faq-q.open .plus { transform: rotate(45deg); }
    .faq-a {
      display: none;
      padding: 0 0 16px;
      font-size: 0.85rem;
      color: var(--gray-600);
      line-height: 1.7;
      max-width: 600px;
    }
    .faq-a.open { display: block; }

    /* Footer */
    .site-footer {
      border-top: 1.5px solid var(--black);
      padding: 24px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .site-footer span {
      font-family: var(--font-mono);
      font-size: 0.68rem;
      color: var(--gray-400);
    }

    /* ── RESPONSIVE ── */
    @media (max-width: 800px) {
      .container { padding: 0 20px; }
      header {
        padding: 0 20px;
      }
      .calc-section {
        padding: 24px 0 32px;
      }
      .calc-grid {
        grid-template-columns: 1fr;
      }
      .result-banner { flex-direction: column; }
      .kpi-strip { flex-direction: row; min-width: 0; }
      .kpi-box { flex: 1; text-align: center; }
      .topic-grid { grid-template-columns: 1fr; }
      .chart-legend {
        flex-wrap: wrap;
        justify-content: flex-end;
      }
    }

    @media (max-width: 560px) {
      .container {
        padding: 0 16px;
      }
      header {
        position: relative;
        height: auto;
        padding: 8px 12px;
      }
      .header-menu-toggle {
        display: block;
        margin-left: auto;
      }
      .header-menu {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--black);
        padding: 10px 16px 14px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.12);
      }
      .header-menu.open {
        display: flex;
      }
      .header-nav {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      .header-nav a {
        width: 100%;
        padding: 8px 0;
      }
      .country-toggle {
        width: 100%;
        justify-content: flex-start;
      }
      .site-footer {
        flex-direction: column;
        align-items: flex-start;
      }
      .chart-wrap {
        height: 220px;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="header-logo">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Mieten vs. Kaufen
    </div>
    <button class="header-menu-toggle" id="headerMenuToggle" aria-label="Menü">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="7" x2="21" y2="7"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="17" x2="21" y2="17"></line>
      </svg>
    </button>
    <div class="header-menu" id="headerMenu">
      <div class="header-nav">
        <a href="#rechner" class="active">Rechner</a>
        <a href="#methodik">Methodik</a>
        <a href="#faq">FAQ</a>
      </div>
      <div class="country-toggle">
        <button class="country-btn active" id="countryAT">
          <svg viewBox="0 0 30 20"><rect width="30" height="20" fill="#ed2939"/><rect y="6.67" width="30" height="6.67" fill="#fff"/></svg>
          AT
        </button>
        <button class="country-btn" id="countryDE">
          <svg viewBox="0 0 30 20"><rect width="30" height="6.67" fill="#000"/><rect y="6.67" width="30" height="6.67" fill="#dd0000"/><rect y="13.33" width="30" height="6.67" fill="#ffce00"/></svg>
          DE
        </button>
      </div>
    </div>
  </header>

  <!-- ═══════════════════════════════════════ -->
  <!-- CALCULATOR                              -->
  <!-- ═══════════════════════════════════════ -->
  <div class="container" id="rechner">
    <div class="calc-section">
      <div class="calc-grid">

        <!-- LEFT: INPUTS -->
        <div class="inputs-panel">
          <div class="mode-toggle">
            <button class="mode-btn active" id="modeEasy">Schnell</button>
            <button class="mode-btn" id="modeExpert">Detailliert</button>
          </div>

          <div class="panel-section">
            <div class="panel-section-title">Deine Situation</div>
            <div class="field">
              <label>Warmmiete pro Monat</label>
              <input id="yourRent" type="number" step="50" value="1500" />
              <div class="hint">€ / Monat</div>
            </div>
            <div class="field">
              <label>Geplanter Kaufpreis</label>
              <input id="purchasePrice" type="number" step="10000" placeholder="z.B. 400000" />
              <div class="hint">€ Immobilienpreis</div>
            </div>
          </div>

          <div class="panel-section">
            <div class="panel-section-title">Zinsen &amp; Rendite</div>
            <div class="field-row">
              <div class="field">
                <label>Kreditzins p.a.</label>
                <input id="interest" type="number" step="0.1" value="2.9" />
                <div class="hint">%</div>
              </div>
              <div class="field">
                <label>Aktienrendite p.a.</label>
                <input id="stockReturn" type="number" step="0.1" value="7.0" />
                <div class="hint">%</div>
              </div>
            </div>
          </div>

          <div class="expert-fields" id="expertFields">
            <div class="panel-section">
              <div class="panel-section-title">Kaufnebenkosten &amp; Kapital</div>
              <div class="field-row">
                <div class="field">
                  <label>Eigenkapital</label>
                  <input id="equityRatio" type="number" step="1" value="20" />
                  <div class="hint">% vom Kaufpreis</div>
                </div>
                <div class="field">
                  <label>Kaufnebenkosten</label>
                  <input id="closingRate" type="number" step="0.5" value="10" />
                  <div class="hint">% vom Kaufpreis</div>
                </div>
              </div>
            </div>
            <div class="panel-section">
              <div class="panel-section-title">Wertentwicklung</div>
              <div class="field-row">
                <div class="field">
                  <label>Wertsteigerung p.a.</label>
                  <input id="propertyGrowth" type="number" step="0.1" value="2.6" />
                  <div class="hint">% Immobilie</div>
                </div>
                <div class="field">
                  <label>Mieterhöhung p.a.</label>
                  <input id="rentGrowth" type="number" step="0.1" value="2.8" />
                  <div class="hint">%</div>
                </div>
              </div>
              <div class="field-row" style="margin-top:10px;">
                <div class="field">
                  <label>Laufende Kosten p.a.</label>
                  <input id="runningRate" type="number" step="0.1" value="1.0" />
                  <div class="hint">% vom Wert</div>
                </div>
                <div class="field">
                  <label>KESt</label>
                  <input id="kest" type="number" step="0.5" value="27.5" />
                  <div class="hint">%</div>
                </div>
              </div>
            </div>
            <div class="panel-section">
              <div class="panel-section-title">Laufzeit</div>
              <div class="field">
                <label>Betrachtungszeitraum</label>
                <input id="termYears" type="number" step="1" value="30" />
                <div class="hint">Jahre</div>
              </div>
            </div>
          </div>

          <div class="panel-section" id="easyInfo">
            <div class="info-box">
              Annahmen: 20 % EK, 10 % Nebenkosten, 1 % laufende Kosten,
              2,6 % Wertsteigerung, 2,8 % Mieterhöhung, <span id="kestInfoText">27,5 % KESt</span>. 30 Jahre.<br>
              → <b>Detailliert</b> für alle Parameter.
            </div>
          </div>
        </div>

        <!-- RIGHT: RESULTS + CHART -->
        <div class="right-col">

          <!-- Result banner -->
          <div class="result-banner">
            <div class="result-banner-main">
              <div class="result-badge">Berechnung</div>
              <div class="result-headline" id="resultHeadline">Gib einen Kaufpreis ein.</div>
              <div class="result-sub" id="resultSub"></div>
              <div class="result-disclaimer" id="resultDisclaimer"></div>
            </div>
            <div class="kpi-strip" id="kpiStrip" style="display:none;">
              <div class="kpi-box kpi-sweetspot">
                <div class="kpi-label">Sweetspot-Kaufpreis</div>
                <div class="kpi-value" id="kpiSweetspot">—</div>
              </div>
              <div class="kpi-box">
                <div class="kpi-label">Effektivbelastung</div>
                <div class="kpi-value" id="kpiMonthly">—</div>
              </div>
            </div>
          </div>

          <!-- Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                Vermögensprognose
              </div>
              <div class="chart-legend">
                <span><span class="line-sample"></span> Schwelle</span>
                <span><span class="dot-filled"></span> Sweetspot</span>
                <span><span class="dot-black"></span> Kaufpreis</span>
              </div>
            </div>
            <div class="chart-wrap">
              <canvas id="sweetspotChart"></canvas>
            </div>
          </div>

          <!-- Details -->
          <div class="details-card" id="detailsCard" style="display:none;">
            <button class="details-toggle" id="detailsToggle">
              Berechnungs-Details
              <span class="chevron">▼</span>
            </button>
            <div class="details-body" id="detailsBody">
              <table class="comp-table">
                <thead>
                  <tr>
                    <th style="width:45%">Kennzahl</th>
                    <th style="text-align:right">Kaufen</th>
                    <th style="text-align:right">Mieten + Invest.</th>
                  </tr>
                </thead>
                <tbody id="compBody"></tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════ -->
  <!-- LANDING PAGE                            -->
  <!-- ═══════════════════════════════════════ -->
  <div class="landing" id="methodik">
    <div class="container">

      <div class="landing-hero">
        <h2>Mieten oder Kaufen?<br><span class="highlight">Berechne deinen Vorteil.</span></h2>
        <p>
          Die Frage „Mieten vs. Kaufen" ist nicht nur eine Gefühlsentscheidung, sondern eine knallharte Rechenaufgabe.
          Oft wird beim Immobilienkauf der wahre Kostenvorteil überschätzt, während beim Mieten die
          Investitionschance des freien Kapitals unterschätzt wird. Unser Rechner vergleicht die Gesamtkosten beider
          Optionen über die volle Laufzeit — inklusive versteckter Faktoren wie Opportunitätskosten, Wertsteigerung und Inflation.
        </p>
      </div>

      <div class="topic-grid">
        <div class="topic-card">
          <h3>Das gebundene Kapital arbeitet nicht</h3>
          <p>
            Wer 80.000 € Eigenkapital in eine Immobilie steckt, kann dieses Geld nicht mehr am Aktienmarkt anlegen.
            Bei 7 % Rendite „kostet" dich das gebundene Kapital in 30 Jahren über 500.000 € an entgangenem Gewinn.
            Unser Rechner stellt genau diesen Nachteil der Kreditbelastung gegenüber.
          </p>
        </div>
        <div class="topic-card">
          <h3>Dein persönlicher Break-Even-Punkt</h3>
          <p>
            Der Sweetspot-Kaufpreis zeigt dir den maximalen Kaufpreis, bis zu dem sich Kaufen gegenüber Mieten + Investieren lohnt.
            Liegt dein Wunschpreis darüber, fährst du mit Miete und ETF-Sparplan besser — mathematisch betrachtet.
          </p>
        </div>
        <div class="topic-card">
          <h3>Versteckte Kosten beim Kauf</h3>
          <p>
            Kaufnebenkosten (Grunderwerbsteuer, Notar, Makler) betragen in Österreich ca. 10 % des Kaufpreises.
            Dazu kommen laufende Kosten für Instandhaltung, Rücklagen und Versicherung — rund 1 % des Immobilienwertes pro Jahr.
          </p>
        </div>
        <div class="topic-card">
          <h3>Miete ist nicht „rausgeworfenes Geld"</h3>
          <p>
            Der häufigste Irrtum: Miete sei verlorenes Geld. In Wahrheit zahlst du als Eigentümer Zinsen, Nebenkosten und
            Opportunitätskosten — oft mehr als die Miete. Die Differenz entscheidet, nicht das Bauchgefühl.
          </p>
        </div>
      </div>

      <!-- FAQ -->
      <div class="faq-section" id="faq">
        <div class="faq-title">Häufige Fragen (FAQ)</div>

        <div class="faq-item">
          <button class="faq-q">Lohnt sich Mieten oder Kaufen?<span class="plus">+</span></button>
          <div class="faq-a">
            Das hängt von individuellen Faktoren wie Kaufpreis, Miethöhe, Zinsniveau, Eigenkapital und
            alternativer Rendite ab. Unser Rechner vergleicht beide Optionen mathematisch exakt und
            berücksichtigt dabei auch versteckte Kosten wie Opportunitätskosten und laufende Instandhaltung.
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-q">Was ist der Sweetspot-Kaufpreis?<span class="plus">+</span></button>
          <div class="faq-a">
            Der Sweetspot-Kaufpreis ist der Break-Even-Punkt: Bis zu diesem Preis lohnt sich Kaufen,
            darüber fährst du mit Miete + Kapitalanlage langfristig besser. Er hängt von deiner aktuellen
            Miete, dem Zinsniveau und der erwarteten Aktienrendite ab.
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-q">Wie werden die Opportunitätskosten berechnet?<span class="plus">+</span></button>
          <div class="faq-a">
            Wir berechnen, was dein Eigenkapital und die monatliche Differenz zwischen Kauf- und Mietkosten
            erwirtschaftet hätten, wenn du sie in einen breit diversifizierten ETF investiert hättest.
            Am Ende wird die Kapitalertragsteuer (KESt 27,5 %) abgezogen. Dies ist oft der entscheidende Faktor im Vergleich.
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-q">Welche Annahmen stecken im Modell?<span class="plus">+</span></button>
          <div class="faq-a">
            Im Schnell-Modus: 20 % Eigenkapital, 10 % Kaufnebenkosten, 1 % laufende Kosten p.a.,
            2,6 % Immobilienwertsteigerung, 2,8 % jährliche Mieterhöhung, KESt (je nach Land) und 30 Jahre Laufzeit.
            Im Detailliert-Modus kannst du jeden dieser Parameter individuell anpassen.
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-q">Ist der Rechner kostenlos?<span class="plus">+</span></button>
          <div class="faq-a">
            Ja, zu 100 %. Das Projekt ist privat finanziert. Wir verkaufen keine Daten und haben keine
            kommerziellen Interessen. Unser Ziel ist finanzielle Transparenz bei der wichtigsten
            finanziellen Entscheidung deines Lebens.
          </div>
        </div>
        <div class="faq-item">
          <button class="faq-q">Was ist die KESt / Kapitalertragsteuer?<span class="plus">+</span></button>
          <div class="faq-a">
            Die Kapitalertragsteuer wird auf Kursgewinne fällig, wenn du ETFs verkaufst. In Österreich beträgt sie
            27,5 %, in Deutschland 26,375 % (inkl. Soli). Wechsle im Header zwischen AT und DE, oder passe den Wert
            im Detailliert-Modus individuell an.
          </div>
        </div>
      </div>

      <footer class="site-footer">
        <span>Mieten vs. Kaufen — Alle Angaben ohne Gewähr</span>
        <span>Privat finanziert · Open Source · <a href="impressum.html" style="color: inherit; text-decoration: underline; text-underline-offset: 2px;">Impressum</a></span>
      </footer>
    </div>
  </div>

  <!-- ═══════════════════════════════════════ -->
  <!-- SCRIPT                                  -->
  <!-- ═══════════════════════════════════════ -->
  <script>
    function gainsForParams(purchasePrice, rent0, params) {
      var equityRatio = params.equityRatio;
      var interestAnnual = params.interestAnnual;
      var termYears = params.termYears;
      var closingRate = params.closingRate;
      var propertyGrowthAnnual = params.propertyGrowthAnnual;
      var runningRate = params.runningRate;
      var rentGrowthAnnual = params.rentGrowthAnnual;
      var stockReturnAnnual = params.stockReturnAnnual;
      var KESt = params.KESt;

      var nYears = termYears, nMonths = termYears * 12;
      var equity = purchasePrice * equityRatio;
      var closingCost = purchasePrice * closingRate;
      var loan = purchasePrice + closingCost - equity;
      var interestMonthly = Math.pow(1 + interestAnnual, 1 / 12) - 1;
      var pmt = loan * interestMonthly / (1 - Math.pow(1 + interestMonthly, -nMonths));

      var totalCreditCosts = pmt * 12 * nYears;
      var totalRunning = 0;
      for (var year = 0; year < nYears; year++) {
        totalRunning += purchasePrice * Math.pow(1 + propertyGrowthAnnual, year) * runningRate;
      }
      var totalExpensesBuy = equity + totalCreditCosts + totalRunning;
      var propertyFinal = purchasePrice * Math.pow(1 + propertyGrowthAnnual, nYears);
      var gainBuy = propertyFinal - totalExpensesBuy;

      var rent = rent0, portfolio = equity, investedCapital = equity, totalRent = 0;
      for (var y = 0; y < nYears; y++) {
        var propVal = purchasePrice * Math.pow(1 + propertyGrowthAnnual, y);
        var costBuy = pmt * 12 + propVal * runningRate;
        var costRent = rent * 12;
        totalRent += costRent;
        var contribution = costBuy - costRent;
        investedCapital += contribution;
        portfolio = portfolio * (1 + stockReturnAnnual) + contribution;
        rent *= (1 + rentGrowthAnnual);
      }
      var totalExpensesRent = investedCapital + totalRent;
      var taxableGain = portfolio - investedCapital;
      var portfolioAfterTax = portfolio - taxableGain * KESt;
      var gainRent = portfolioAfterTax - totalExpensesRent;

      return {
        gainBuy: gainBuy, gainRent: gainRent,
        propertyFinal: propertyFinal,
        totalExpensesBuy: totalExpensesBuy,
        portfolioAfterTax: portfolioAfterTax,
        totalExpensesRent: totalExpensesRent,
        equity: equity, loan: loan,
        monthlyRate: pmt, closingCost: closingCost,
        totalCreditCosts: totalCreditCosts,
        totalRunning: totalRunning, totalRent: totalRent,
        firstYearRunningMonthly: purchasePrice * runningRate / 12
      };
    }

    function findThreshold(rent0, params) {
      var pMin = 100000, pMax = 2000000;
      function diff(p) { var r = gainsForParams(p, rent0, params); return r.gainBuy - r.gainRent; }
      var dMin = diff(pMin), dMax = diff(pMax);
      if (isNaN(dMin) || isNaN(dMax) || dMin * dMax > 0) return NaN;
      var lo = pMin, hi = pMax;
      for (var i = 0; i < 60; i++) { var m = (lo + hi) / 2; if (diff(m) > 0) lo = m; else hi = m; }
      return (lo + hi) / 2;
    }

    function fmt(n) { return n.toLocaleString("de-AT", { maximumFractionDigits: 0 }); }

    function getParams() {
      var iv = parseFloat(document.getElementById("interest").value);
      var sv = parseFloat(document.getElementById("stockReturn").value);
      if (isNaN(iv) || isNaN(sv)) return null;
      return {
        equityRatio: parseFloat(document.getElementById("equityRatio").value) / 100,
        interestAnnual: iv / 100,
        termYears: parseInt(document.getElementById("termYears").value) || 30,
        closingRate: parseFloat(document.getElementById("closingRate").value) / 100,
        propertyGrowthAnnual: parseFloat(document.getElementById("propertyGrowth").value) / 100,
        runningRate: parseFloat(document.getElementById("runningRate").value) / 100,
        rentGrowthAnnual: parseFloat(document.getElementById("rentGrowth").value) / 100,
        stockReturnAnnual: sv / 100,
        KESt: parseFloat(document.getElementById("kest").value) / 100
      };
    }

    var sweetspotChart = null;

    function recompute() {
      var params = getParams();
      if (!params) return;

      var yourRent = parseFloat(document.getElementById("yourRent").value);
      var purchasePrice = parseFloat(document.getElementById("purchasePrice").value);
      var T = params.termYears;

      // Diagonal
      var diagonalPoints = [];
      for (var r = 500; r <= 3500; r += 50) {
        var th = findThreshold(r, params);
        if (!isNaN(th)) {
          diagonalPoints.push({ x: r, y: th + th * params.closingRate - th * params.equityRatio });
        }
      }

      // Sweetspot
      var sweetspotPoint = null, sweetspotPrice = NaN;
      if (!isNaN(yourRent) && yourRent > 0) {
        sweetspotPrice = findThreshold(yourRent, params);
        if (!isNaN(sweetspotPrice)) {
          sweetspotPoint = { x: yourRent, y: sweetspotPrice + sweetspotPrice * params.closingRate - sweetspotPrice * params.equityRatio };
        }
      }

      // KPIs
      var kpiStrip = document.getElementById("kpiStrip");
      var kpiSweetspot = document.getElementById("kpiSweetspot");
      var kpiMonthly = document.getElementById("kpiMonthly");
      if (!isNaN(sweetspotPrice)) {
        kpiStrip.style.display = "flex";
        kpiSweetspot.innerHTML = fmt(sweetspotPrice) + ' <span class="kpi-unit">€</span>';
      } else {
        kpiSweetspot.textContent = "—";
      }

      // Result
      var headline = document.getElementById("resultHeadline");
      var sub = document.getElementById("resultSub");
      var disclaimer = document.getElementById("resultDisclaimer");
      var detailsCard = document.getElementById("detailsCard");
      var resultBanner = document.querySelector(".result-banner");

      var purchasePoint = null, diffLinePoints = null, buyBetter = null;

      if (!isNaN(purchasePrice) && purchasePrice > 0 && !isNaN(yourRent) && yourRent > 0) {
        var comp = gainsForParams(purchasePrice, yourRent, params);
        var diffGain = comp.gainBuy - comp.gainRent;
        buyBetter = diffGain > 0;

        resultBanner.classList.remove("has-result", "buy-wins", "rent-wins");
        resultBanner.classList.add("has-result");
        if (diffGain > 0) {
          headline.innerHTML = '<span class="result-keyword">Kaufen</span> lohnt sich.';
          resultBanner.classList.add("buy-wins");
        } else if (diffGain < 0) {
          headline.innerHTML = '<span class="result-keyword">Mieten</span> lohnt sich.';
          resultBanner.classList.add("rent-wins");
        } else {
          headline.innerHTML = "Beide Optionen sind gleich.";
        }

        var colorClass = diffGain > 0 ? "val-positive" : "val-negative";
        sub.innerHTML =
          "Dein Vermögensvorteil beträgt <b class='" + colorClass + "'>" + fmt(Math.abs(diffGain)) + " €</b> nach " + T + " Jahren." +
          "<br>Kaufpreis: <b>" + fmt(purchasePrice) + " €</b> · Kreditsumme: <b>" + fmt(comp.loan) + " €</b> · EK: <b>" + fmt(comp.equity) + " €</b>";

        disclaimer.textContent = "Alle Berechnungen sind unverbindliche Schätzungen. Keine Haftung für Richtigkeit oder finanzielle Verluste.";
        kpiMonthly.innerHTML = fmt(comp.monthlyRate + comp.firstYearRunningMonthly) + ' <span class="kpi-unit">€/Mo</span>';
        kpiStrip.style.display = "flex";

        purchasePoint = { x: yourRent, y: comp.loan };
        if (sweetspotPoint) {
          diffLinePoints = [{ x: yourRent, y: comp.loan }, { x: yourRent, y: sweetspotPoint.y }];
        }

        detailsCard.style.display = "block";
        document.getElementById("compBody").innerHTML = [
          row("Eigenkapital (" + (params.equityRatio * 100).toFixed(0) + " %)", fmt(comp.equity) + " €", fmt(comp.equity) + " € (inv.)"),
          row("Kaufnebenkosten (" + (params.closingRate * 100).toFixed(0) + " %)", fmt(comp.closingCost) + " €", "—"),
          row("Kreditsumme", fmt(comp.loan) + " €", "—"),
          row("Monatl. Kreditrate", fmt(comp.monthlyRate) + " €", "—"),
          row("Laufende Kosten (1. J./Mo.)", fmt(comp.firstYearRunningMonthly) + " €", "—"),
          row("Gesamtbelastung (1. J./Mo.)", fmt(comp.monthlyRate + comp.firstYearRunningMonthly) + " €", fmt(yourRent) + " €"),
          row("Gesamtausgaben (" + T + " J.)", fmt(comp.totalExpensesBuy) + " €", fmt(comp.totalExpensesRent) + " €"),
          row('Endvermögen <span class=\"info-icon\" data-info=\"Ein negativer Wert bedeutet, die monatlichen Mietkosten sind höher als dein Investment.\">i</span>', fmt(comp.propertyFinal) + " €", fmt(comp.portfolioAfterTax) + " €"),
          rowColored('Saldo (Endvermögen − Ausgaben) <span class=\"info-icon\" data-info=\"Ein negativer Wert bedeutet, dass das Endvermögen niedriger ist als die Summe der Ausgaben – nicht, dass dein Investment negativ ist.\">i</span>', (diffGain >= 0 ? "+" : "") + fmt(diffGain) + " €", "", diffGain)
        ].join("");

        // Info-Popups an (i)-Icons hängen
        document.querySelectorAll("#compBody .info-icon").forEach(function (icon) {
          icon.addEventListener("click", function (e) {
            e.stopPropagation();
            // vorhandene Popups schließen
            document.querySelectorAll(".info-popup").forEach(function (p) { p.remove(); });
            var text = icon.getAttribute("data-info");
            if (!text) return;
            var popup = document.createElement("span");
            popup.className = "info-popup";
            popup.textContent = text;
            document.body.appendChild(popup);

            var rect = icon.getBoundingClientRect();
            var padding = 8;

            // Erst einmal unten positionieren
            popup.style.left = Math.min(
              rect.left,
              window.innerWidth - popup.offsetWidth - padding
            ) + "px";
            popup.style.top = (rect.bottom + 6) + "px";

            // Wenn unten kein Platz: nach oben verschieben
            var overflowBottom = rect.bottom + 6 + popup.offsetHeight + padding - window.innerHeight;
            if (overflowBottom > 0) {
              var newTop = rect.top - popup.offsetHeight - 6;
              if (newTop < padding) newTop = padding;
              popup.style.top = newTop + "px";
            }
          });
        });
      } else {
        resultBanner.classList.remove("has-result", "buy-wins", "rent-wins");
        if (!isNaN(sweetspotPrice)) {
          headline.innerHTML = "Sweetspot: " + fmt(sweetspotPrice) + " €";
          sub.innerHTML = "Bis zu diesem Kaufpreis lohnt sich Kaufen bei <b>" + fmt(yourRent) + " € Miete</b>. Darüber ist Mieten + Investieren besser.";
        } else {
          headline.innerHTML = "Gib einen Kaufpreis ein.";
          sub.innerHTML = "";
        }
        disclaimer.textContent = "";
        kpiMonthly.textContent = "—";
        detailsCard.style.display = "none";
        if (isNaN(sweetspotPrice)) kpiStrip.style.display = "none";
      }

      // Chart
      var ctx = document.getElementById("sweetspotChart").getContext("2d");
      if (sweetspotChart) sweetspotChart.destroy();

      var datasets = [{
        label: "Max. Kreditsumme (Schwelle)",
        data: diagonalPoints, showLine: true, borderWidth: 2, pointRadius: 0,
        borderColor: "#0a0a0a", backgroundColor: "rgba(10,10,10,0.03)", fill: true
      }];
      if (sweetspotPoint) datasets.push({
        label: "Dein Sweetspot", data: [sweetspotPoint], showLine: false,
        pointRadius: 7, pointBackgroundColor: "#1a7f4b", pointBorderColor: "#fff", pointBorderWidth: 2
      });
      if (purchasePoint) datasets.push({
        label: "Dein Kaufpreis", data: [purchasePoint], showLine: false,
        pointRadius: 7,
        pointBackgroundColor: "#0a0a0a",
        pointBorderColor: "#fff", pointBorderWidth: 2
      });
      if (diffLinePoints) datasets.push({
        label: "Abweichung", data: diffLinePoints, showLine: true, pointRadius: 0,
        borderWidth: 2, borderDash: [5, 4], borderColor: "rgba(10,10,10,0.35)"
      });

      sweetspotChart = new Chart(ctx, {
        type: "scatter",
        data: { datasets: datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: { duration: 250 },
          scales: {
            x: {
              type: "linear",
              title: { display: true, text: "Anfangsmiete (€/Monat)", font: { family: "'Space Mono', monospace", size: 10 } },
              grid: { color: "rgba(0,0,0,0.04)" }, border: { color: "#ddd" },
              ticks: { font: { family: "'Space Mono', monospace", size: 9 } }
            },
            y: {
              type: "linear",
              title: { display: true, text: "Kreditsumme (€)", font: { family: "'Space Mono', monospace", size: 10 } },
              grid: { color: "rgba(0,0,0,0.04)" }, border: { color: "#ddd" },
              ticks: { font: { family: "'Space Mono', monospace", size: 9 } }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: "#0a0a0a", cornerRadius: 8,
              titleFont: { family: "'Space Mono', monospace", size: 11 },
              bodyFont: { family: "'Space Mono', monospace", size: 11 },
              callbacks: {
                label: function (ctx) {
                  return (ctx.dataset.label || "") + ": Miete " + fmt(ctx.parsed.x) + " € → Kredit " + fmt(ctx.parsed.y) + " €";
                }
              }
            }
          }
        }
      });
    }

    function row(l, b, r) { return "<tr><td>" + l + "</td><td>" + b + "</td><td>" + r + "</td></tr>"; }
    function rowColored(l, b, r, val) {
      var cls = val > 0 ? "val-positive" : val < 0 ? "val-negative" : "";
      return "<tr><td>" + l + "</td><td class='" + cls + "'>" + b + "</td><td>" + r + "</td></tr>";
    }

    // Mode toggle
    document.getElementById("modeEasy").addEventListener("click", function () {
      this.classList.add("active");
      document.getElementById("modeExpert").classList.remove("active");
      document.getElementById("expertFields").classList.remove("visible");
      document.getElementById("easyInfo").style.display = "";
    });
    document.getElementById("modeExpert").addEventListener("click", function () {
      this.classList.add("active");
      document.getElementById("modeEasy").classList.remove("active");
      document.getElementById("expertFields").classList.add("visible");
      document.getElementById("easyInfo").style.display = "none";
      // Auto-expand details when switching to detailed mode
      var toggle = document.getElementById("detailsToggle");
      var body = document.getElementById("detailsBody");
      if (!body.classList.contains("open")) {
        toggle.classList.add("open");
        body.classList.add("open");
      }
    });

    // Country toggle
    var currentCountry = "AT";
    var kestValues = { AT: 27.5, DE: 26.375 };

    function setCountry(country) {
      currentCountry = country;
      document.getElementById("countryAT").classList.toggle("active", country === "AT");
      document.getElementById("countryDE").classList.toggle("active", country === "DE");
      document.getElementById("kest").value = kestValues[country];
      document.getElementById("kestInfoText").textContent = kestValues[country].toString().replace(".", ",") + " % KESt";
      recompute();
    }

    document.getElementById("countryAT").addEventListener("click", function () { setCountry("AT"); });
    document.getElementById("countryDE").addEventListener("click", function () { setCountry("DE"); });

    // Details accordion
    document.getElementById("detailsToggle").addEventListener("click", function () {
      this.classList.toggle("open");
      document.getElementById("detailsBody").classList.toggle("open");
    });

    // FAQ accordion
    document.querySelectorAll(".faq-q").forEach(function (btn) {
      btn.addEventListener("click", function () {
        this.classList.toggle("open");
        this.nextElementSibling.classList.toggle("open");
      });
    });

    // Klick außerhalb schließt Info-Popups
    document.addEventListener("click", function () {
      document.querySelectorAll(".info-popup").forEach(function (p) { p.remove(); });
    });

    // Wire inputs
    ["interest", "stockReturn", "yourRent", "purchasePrice",
     "equityRatio", "closingRate", "runningRate", "propertyGrowth",
     "rentGrowth", "kest", "termYears"].forEach(function (id) {
      document.getElementById(id).addEventListener("input", recompute);
    });

    // Mobile header menu
    var headerMenuToggle = document.getElementById("headerMenuToggle");
    var headerMenu = document.getElementById("headerMenu");
    if (headerMenuToggle && headerMenu) {
      headerMenuToggle.addEventListener("click", function () {
        headerMenu.classList.toggle("open");
      });
      // Close menu after clicking a navigation link
      headerMenu.querySelectorAll(".header-nav a").forEach(function (link) {
        link.addEventListener("click", function () {
          headerMenu.classList.remove("open");
        });
      });
    }

    window.addEventListener("load", recompute);
  </script>
</body>
</html>
